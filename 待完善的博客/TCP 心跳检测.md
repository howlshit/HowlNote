## 1. 短连接

早期1.0的HTTP使用短连接，一次请求就传输一次数据，传输完立马释放TCP连接。这样一个网站有多少个资源（图片等）就会有多少次请求





## 2. 长连接

HTTP1.1之后，首部字段多了 keepalive选项来支持长连接。长连接客户端和服务器建立连接之后，不断开，直到有一方主动关闭，所以一个TCP连接上可以有多次请求和响应





## 3. 长连接保活

长连接不断开，免去了DNS解析，TCP连接建立，慢启动等问题。但长连接无法很好的保持，连接失效后还继续发请求那么会等待到响应超时，然后再建立一次连接，效率低下，此时需要心跳保活



心跳保活通常是客户端在应用层每隔一段时间向服务器发送一个数据包，通知服务器自己仍然在线，并传输一些可能必要的数据

















## 1. TCP 心跳检测

通客户端每隔一小段时间向服务器发送一个数据包，通知服务器自己仍然在线，并传输一些可能必要的数据。使用心跳包的典型协议是IM



心跳包（ACK-ACK两个确认包）之所以叫心跳包是因为：它像心跳一样每隔固定时间发一次，以此来告诉服务器，这个客户端还活着。事实上这是为了保持长连接，至于这个包的内容，是没有什么特别规定的，不过一般都是很小的包，或者只包含包头的一个空包。



在TCP的机制里面，本身是存在有心跳包的机制的，也就是TCP的选项：SO_KEEPALIVE。系统默认是设置的2小时的心跳频率。但是它检查不到机器断电、网线拔出、防火墙这些断线。而且逻辑层处理断线可能也不是那么好处理。一般，如果只是用于保活还是可以的。





**心跳检测步骤：**
   1客户端每隔一个时间间隔发生一个探测包给服务器
   2客户端发包时启动一个超时定时器
   3服务器端接收到检测包，应该回应一个包
   4如果客户机收到服务器的应答包，则说明服务器正常，删除超时定时器
   5如果客户端的超时定时器超时，依然没有收到应答包，则说明服务器挂了